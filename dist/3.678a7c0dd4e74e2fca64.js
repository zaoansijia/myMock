webpackJsonp([3],{16:function(e,r,t){"use strict";function s(e){t(244)}Object.defineProperty(r,"__esModule",{value:!0});var a=t(205),o=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(r,e,function(){return a[e]})}(i);var l=t(246),n=t(1),m=s,p=n(o.a,l.a,!1,m,null,null);r.default=p.exports},205:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t(2),a=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(s),o=t(43),i=function(e){return e&&e.__esModule?e:{default:e}}(o);r.default={name:"serverurl",data:function(){var e=this;this.$createElement;return{type:"add",pageName:this.$t("p.server.nav[0]"),nav:[{title:this.$t("p.server.nav[0]"),icon:"android-list"},{title:this.$t("p.server.nav[1]"),icon:"gear-a"}],form:{name:"",url:"",project:"",projSaveName:"",transmitUrl:"",switchUrl:!1},ruleValidate:{project:[{required:!0,message:this.$t("p.server.formErr.project.empty"),trigger:"blur"}],projSaveName:[{required:!0,message:this.$t("p.server.formErr.projSaveName.empty"),trigger:"blur"},{pattern:/^[a-zA-z]+$/,message:this.$t("p.server.formErr.projSaveName.format"),trigger:"blur"}],name:[{required:!0,message:this.$t("p.server.formErr.name.empty"),trigger:"blur"}],url:[{required:!0,message:this.$t("p.server.formErr.url.empty"),trigger:"blur"}],transmitUrl:[{pattern:/^(\/\w+)+(,(\/\w+)+)*$/,message:this.$t("p.server.formErr.transmitUrl.format"),trigger:"blur"}]},keywords:"",columns:[{title:this.$t("p.server.column[0]"),width:120,sortable:!1,key:"project"},{title:this.$t("p.server.column[1]"),width:140,sortable:!1,key:"projSaveName"},{title:this.$t("p.server.column[2]"),width:120,ellipsis:!0,sortable:!1,key:"name"},{title:this.$t("p.server.column[3]"),width:200,sortable:!1,key:"url"},{title:this.$t("p.server.column[4]"),sortable:!1,key:"transmitUrl"},{title:this.$t("p.server.column[5]"),width:90,ellipsis:!0,sortable:!1,key:"switchUrl",render:function(r,t){var s=e.$store.state.user.selectedUrl&&e.$store.state.user.selectedUrl[t.row.projSaveName];return s&&t.row.url===s.serverurl?r("span",null,["是"]):r("span",null,["否"])}},{title:this.$t("p.server.column[6]"),key:"action",width:90,align:"center",render:function(r,t){return r("div",null,[r("Button-group",null,[r("i-button",{attrs:{size:"small",title:e.$t("p.server.edit.action")},on:{click:e.editRow.bind(e,t.row)}},[r("icon",{attrs:{type:"edit"}},[])]),r("i-button",{attrs:{size:"small",title:e.$t("p.server.remove.action")},on:{click:e.delete.bind(e,t.row)}},[r("icon",{attrs:{type:"trash-b"}},[])])])])}}]}},asyncData:function(e){var r=e.store,t=e.route;return r.commit("serverurl/INIT_REQUEST"),r.dispatch("serverurl/FETCH",t)},watch:{pageName:function(e){e===this.$t("p.server.nav[0]")&&(this.form.name="",this.form.url="",this.form.project="",this.form.projSaveName="",this.form.transmitUrl="",this.form.switchUrl=!1,this.type="add")}},mounted:function(){var e=this;this.$on("query",(0,i.default)(function(r){e.keywords=r},500))},computed:{list:function(){var e=this.$store.state.serverurl.list,r=this.keywords&&new RegExp(this.keywords,"i");return r?e.filter(function(e){return r.test(e.name)||r.test(e.url)||r.test(e.project)}):e}},methods:{operate:function(e){var r=this,t={},s="",o=this.$store.state.user;this.$refs.form.validate(function(i){if(i){switch(e){case"add":t=a.serverUrl.add({data:r.form}),s=r.$t("p.server.add.success");break;default:t=a.serverUrl.update({data:r.form}),s=r.$t("p.server.edit.success")}Promise.all([t,r.updateUser(e,o)]).then(function(e){e[0].data.success&&(r.$Message.success(s),r.$store.commit("serverurl/INIT_REQUEST"),r.$store.dispatch("serverurl/FETCH"))})}})},updateUser:function(e,r){var t=this,s=r.selectedUrl[this.form.projSaveName];this.form.switchUrl?r.selectedUrl[this.form.projSaveName]={hasSelected:this.form.switchUrl,serverurl:this.form.url,transmitUrl:this.form.transmitUrl}:s&&s.hasSelected&&this.form.url===s.serverurl&&(r.selectedUrl[this.form.projSaveName]=void 0),a.u.update({data:r}).then(function(e){t.$ls.set("user",r)})},editRow:function(e){this.type="edit",this.form.id=e._id,this.form.project=e.project,this.form.projSaveName=e.projSaveName,this.form.name=e.name,this.form.url=e.url,this.form.transmitUrl=e.transmitUrl;var r=this.$store.state.user.selectedUrl&&this.$store.state.user.selectedUrl[e.projSaveName];this.form.switchUrl=r&&r.hasSelected&&this.form.url===r.serverurl,this.pageName=this.$t("p.server.nav[1]")},delete:function(e){var r=this;this.$Modal.confirm({title:this.$t("confirm.title"),content:this.$t("p.server.remove.confirm"),onOk:function(){a.serverUrl.delete({data:{id:e._id}}).then(function(t){if(t.data.success){var s=r.$store.state.user.selectedUrl&&r.$store.state.user.selectedUrl[e.projSaveName];if(s&&e.url===s.serverurl){var o=r.$store.state.user;o.selectedUrl[e.projSaveName]=void 0,a.u.update({data:o}).then(function(e){r.$ls.set("user",o)})}r.$Message.success(r.$t("p.server.remove.success")),r.$store.commit("serverurl/INIT_REQUEST",{pageIndex:1}),r.$store.dispatch("serverurl/FETCH",r.$route)}})}})}}}},244:function(e,r,t){var s=t(245);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);t(152)("228c1a73",s,!0)},245:function(e,r,t){r=e.exports=t(151)(),r.push([e.i,'.em-server-url .desc{color:gray}.em-server-url__form{padding:0 20px;max-width:1020px;margin:auto}.em-server-url__form__content{padding:66px 220px 100px;margin-top:20px;width:100%;background:#fff;-webkit-box-shadow:0 2px 3px #eee;box-shadow:0 2px 3px #eee;border-radius:4px;margin-bottom:20px}.em-server-url__form__content button{margin-top:20px}.em-server-url__form__content .icon{text-align:center}.em-server-url__form__content .project label:before{content:"*";display:inline-block;margin-right:4px;line-height:1;font-family:SimSun;font-size:12px;color:#ed3f14}.em-server-url__form__content .project .ivu-form-item-error-tip{margin-top:30px}.em-server-url__table{padding:0 20px;max-width:1020px;margin:auto;margin-top:20px}.em-server-url__table .ivu-table-body{overflow-x:hidden;overflow-y:auto;height:500px}.em-server-url__table .search{width:420px;margin-bottom:20px}',""])},246:function(e,r,t){"use strict";var s=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"em-server-url"},[t("em-header",{attrs:{icon:"cube",title:e.pageName,description:e.$t("p.server.title[1]"),nav:e.nav},model:{value:e.pageName,callback:function(r){e.pageName=r},expression:"pageName"}}),t("Back-top",[t("em-add",{attrs:{icon:"arrow-up-c",bottom:90}})],1),t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.pageName===e.$t("p.server.nav[1]")?t("div",{key:"a",staticClass:"em-server-url__form"},[t("div",{staticClass:"em-server-url__form__content"},[t("Form",{ref:"form",attrs:{model:e.form,rules:e.ruleValidate,"label-position":"top"}},[t("Form-item",{staticClass:"project",attrs:{label:e.$t("p.server.form.project[0]")}},[t("Row",[t("Col",{attrs:{span:"12"}},[t("Form-item",{attrs:{prop:"project"}},[t("i-input",{attrs:{size:"large",placeholder:e.$t("p.server.form.project[1]")},model:{value:e.form.project,callback:function(r){e.$set(e.form,"project",r)},expression:"form.project"}})],1)],1),t("Col",{attrs:{span:"1","class-name":"icon"}},[e._v("&")]),t("Col",{attrs:{span:"11"}},[t("Form-item",{attrs:{prop:"projSaveName"}},[t("i-input",{attrs:{size:"large",placeholder:e.$t("p.server.form.projSaveName[1]")},model:{value:e.form.projSaveName,callback:function(r){e.$set(e.form,"projSaveName",r)},expression:"form.projSaveName"}})],1)],1)],1),t("p",{staticClass:"desc"},[e._v(e._s(e.$t("p.server.form.project[2]")))])],1),t("Form-item",{attrs:{label:e.$t("p.server.form.name[0]"),prop:"name"}},[t("i-input",{attrs:{size:"large",placeholder:e.$t("p.server.form.name[1]")},model:{value:e.form.name,callback:function(r){e.$set(e.form,"name",r)},expression:"form.name"}}),t("p",{staticClass:"desc"},[e._v(e._s(e.$t("p.server.form.name[2]")))])],1),t("Form-item",{attrs:{label:e.$t("p.server.form.url[0]"),prop:"url"}},[t("i-input",{attrs:{size:"large",placeholder:e.$t("p.server.form.url[1]")},model:{value:e.form.url,callback:function(r){e.$set(e.form,"url",r)},expression:"form.url"}}),t("p",{staticClass:"desc"},[e._v(e._s(e.$t("p.server.form.url[2]")))])],1),t("Form-item",{attrs:{label:e.$t("p.server.form.transmitUrl[0]"),prop:"transmitUrl"}},[t("i-input",{attrs:{size:"large",type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:e.$t("p.server.form.transmitUrl[1]")},model:{value:e.form.transmitUrl,callback:function(r){e.$set(e.form,"transmitUrl",r)},expression:"form.transmitUrl"}}),t("p",{staticClass:"desc"},[e._v(e._s(e.$t("p.server.form.transmitUrl[2]")))])],1),t("Form-item",{attrs:{label:e.$t("p.server.form.select[0]")}},[t("i-switch",{attrs:{size:"large"},model:{value:e.form.switchUrl,callback:function(r){e.$set(e.form,"switchUrl",r)},expression:"form.switchUrl"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),"add"===e.type?t("Button",{attrs:{type:"primary",long:""},on:{click:function(r){e.operate("add")}}},[e._v(" "+e._s(e.$t("p.server.add.btnTxt"))+" ")]):e._e(),"edit"===e.type?t("Button",{attrs:{type:"primary",long:""},on:{click:function(r){e.operate("edit")}}},[e._v(" "+e._s(e.$t("p.server.edit.btnTxt"))+" ")]):e._e()],1)],1)]):e._e(),e.pageName===e.$t("p.server.nav[0]")?t("div",{key:"b",staticClass:"em-server-url__table"},[t("i-input",{staticClass:"search",attrs:{placeholder:"Search URL / Name / project"},model:{value:e.keywords,callback:function(r){e.keywords=r},expression:"keywords"}}),t("Table",{attrs:{border:"",columns:e.columns,data:e.list,"highlight-row":!0}})],1):e._e()])],1)},a=[],o={render:s,staticRenderFns:a};r.a=o}});